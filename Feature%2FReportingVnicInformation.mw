<!-- {{autolang|base=yes}} -->

== Reporting vNIC information reported by Guest Agent ==

=== Summary ===
The Guest Agent reports the vNic details: 
* IP addresses (both IPv4 and IPv6).
* vNic internal name

The retrieved information by the Guest Agent should be reported to the ovirt-engine and to be viewed by its client<BR>
Today only the IPv4 addresses are reported to the User, kept on VM level. This feature will maintain the information on vNic level.<BR>

=== Owner ===
* Name: Moti Asayag
* Email: masayag@redhat.com

=== Current status ===
[[http://wiki.ovirt.org/wiki/Feature/DetailedReportingVnicInformation Reporting vNIC implementation reported by Guest Agent Detailed Design]]

=== User Experience ===

==== API Changes ====
New attributes will be added to VM nics collection /api/vms/{vm:id}/nics:
* IPv4 addresses reported by the guest agent
   <guest_agent_ipv4_addresses>
       <ip address="1.1.1.1"/>
       <ip address="2.2.2.2"/>
   </guest_agent_ipv4_addresses>
* IPv6 addresses  reported by the guest agent
   <guest_agent_ipv6_addresses>
       <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7335"/>
       <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7336"/>
   </guest_agent_ipv6_addresses>
* interface_name
   <interface_name>p1p2</interface_name>

Note that ''ipv4_addresses'' and ''ipv6_addresses'' are saved for IP allocation feature for stating the IP(s) set by the engine for the vNic.

===== Backward compatibility =====
Note that the existing IPs reported on /api/vms/{vm:id} are left intact, however the IPs addresses are retrieved from the VM's nics.
   <guest_info>
       <ips>
           <ip address="1.1.1.1"/>
           <ip address="2.2.2.2"/>
       </ips>
   </guest_info>

However it will be extended to contain also the network devices configuration on the guest:
   <guest_info>
       <network_devices>
           <interface>
               <name>p1p2</name>
               <ipv4_addresses>
                   <ip address="1.1.1.1"/>
                   <ip address="2.2.2.2"/>
               </ipv4_addresses>
               <ipv6_addresses>
                   <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7335"/>
                   <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7336"/>
               </ipv6_addresses>
               <mac address="AA:AA:AA:AA:AA:AA"/>
           </interface>
       </network_devices>
   </guest_info>

Populating the VM's '''network_devices''' element under '''guest_info''' is implemented by mechanism introduced by [http://gerrit.ovirt.org/#/c/9018 "All-Content Header" patch]<BR>
Only if the request header contains the 'All-Content' property with 'true' value, will populate the network_device information for the VM.

==== UI Changes ====
Administrator Portal:
* VM Main-Tab - No changes:
** On ip address column the entire list of IP addresses will be presented instead (single space delimiter between the IPs)
* VM Network Interface sub-tab:
** Add column 'interface name' (before mac-address field) - presents the internal name of the vNic.
** Add column 'IPv4 Address' (after mac-address field) - presents the IPv4 addresses of the vNic (for multiple addresses per vnic, field includes a comma delimited list).
** Add column 'IPv6 Address' (after ipv4 addresses field) - presents the IPv6 addresses of the vNic (for multiple addresses per vnic, field includes a comma delimited list).
 
User Portal:
* VM Network Interface sub-tab:
** Add column 'interface name' (before mac-address field) - presents the internal name of the vNic.
** Add column 'IPv4 Address' (after mac-address field) - presents the IPv4 addresses of the vNic (for multiple addresses per vnic, field includes a comma delimited list).
** Add column 'IPv6 Address' (after ipv4 addresses field) - presents the IPv6 addresses of the vNic (for multiple addresses per vnic, field includes a comma delimited list).

=== Benefit to oVirt ===
The feature is an enhancement of the oVirt engine vNic management:
* It allows easily association of the managed vNic on engine side by its name with the the actual guest's vNic (instead of comparing MAC Addresses).
* It provides the information required to connect by IP to a specific network.

=== Dependencies / Related Features ===
Affected oVirt projects:
* Engine-core
* API
* Admin Portal
* User Portal

=== Open Issues ===
'''Suggested naming alternatives''':<BR>
* ipv4_addresses --> inet
* ipv6_addresses --> inet6

[[Category: Feature]]
