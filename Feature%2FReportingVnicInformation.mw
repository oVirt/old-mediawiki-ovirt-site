<!-- {{autolang|base=yes}} -->

== Reporting vNIC information reported by Guest Agent ==

=== Summary ===
The Guest Agent reports the vNic details: 
* IP addresses (both IPv4 and IPv6).
* vNic internal name

The retrieved information by the Guest Agent should be reported to the ovirt-engine and to be viewed by its client<BR>
Today only the IPv4 addresses are reported to the User, kept on VM level. This feature will maintain the information on vNic level.<BR>

=== Owner ===
* Name: Moti Asayag
* Email: masayag@redhat.com

=== Current status ===
[[http://wiki.ovirt.org/wiki/Feature/DetailedReportingVnicInformation Reporting vNIC implementation reported by Guest Agent Detailed Design]]

=== User Experience ===

==== API Changes ====
New attributes will be added to VM nics collection /api/vms/{vm:id}/nics:

    <nics>
        <nic id="56d6d62f-6af0-4c02-8500-4be041180031">
            <name>nic1</name>
            ...
            <guest_interfaces>
                <guest_interface>
                    <interface_name>p1p2</interface_name>
                    <mac address="AA:AA:AA:AA:AA:AA"/>
   
                     <!-- IPv4 addresses reported by the guest agent -->
                    <ipv4_addresses>
                        <ip address="1.1.1.1"/>
                        <ip address="2.2.2.2"/>
                    </ipv4_addresses>
   
                    <!-- IPv6 addresses reported by the guest agent -->
                    <ipv6_addresses>
                        <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7335"/>
                        <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7336"/>
                    </ipv6_addresses>
                </guest_interface>
                ...
            </guest_interfaces>
        </nic>
        ...
    </nics>

===== Backward compatibility =====
Note that the existing IPs reported on /api/vms/{vm:id} are left intact, however the IPs addresses are retrieved from the VM's nics.
   <guest_info>
       <ips>
           <ip address="1.1.1.1"/>
           <ip address="2.2.2.2"/>
       </ips>
   </guest_info>

However it will be extended to contain also the network devices configuration on the guest:
   <guest_info>
       ...
       <reported_data>
           <network>
               <rel="devices" href=/api/vms/{vm:id}/devices>
           </network>
       <reported_data/>
   <guest_info/>

<device id=yy href=/api/vms/{vm:id}/devices/{device:id}>
        <name>p1p2</name>
        <description>guest reported data</description>
        <ip type=v4></ip>
        <ip type=v6></ip>
        <mac></mac>        
<device/>
       <guest_interfaces>
           <guest_interface>
               <interface_name>p1p2</interface_name>
               <ipv4_addresses>
                   <ip address="1.1.1.1"/>
                   <ip address="2.2.2.2"/>
               </ipv4_addresses>
               <ipv6_addresses>
                   <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7335"/>
                   <ip address="2001:0db8:85a3:0042:0000:8a2e:0370:7336"/>
               </ipv6_addresses>
               <mac address="AA:AA:AA:AA:AA:AA"/>
           </guest_interface>
           ...
       </guest_interfaces>
   </guest_info>

Populating the VM's '''network_devices''' element under '''guest_info''' is implemented by mechanism introduced by [http://gerrit.ovirt.org/#/c/9815 "All-Content Header" patch]<BR>
Only if the request header contains the 'All-Content=true', the network's devices information will be populate the for the VM.

==== UI Changes ====
Administrator Portal:
* VM Main-Tab - No changes:
** On ip address column the entire list of IP addresses will be presented instead (single space delimiter between the IPs)

* VM Network Interface sub-tab (both Admin Portal and User Portal):
A split view of the VM's Network Interfaces sub-tab will present the information reported by the Guest Agent:
* When there is a match by MAC Address between the vNic's definition on management to the reported vNic by the Guest Agent.

[[File:VmInterfaceSubTab.png|1100px]]

* The Guest Agent only reports devices that are up, therefore we are not able to report vNics that are down.
* The Guest Agent is not updated upon change, but rather periodically every 2 minutes, therefore user may experience a slight delay when updating/adding a vNic.

=== Benefit to oVirt ===
The feature is an enhancement of the oVirt engine vNic management:
* It allows easily association of the managed vNic on engine side by its name with the the actual guest's vNic (instead of comparing MAC Addresses).
* It provides the information required to connect by IP to a specific network.

=== Dependencies / Related Features ===
Affected oVirt projects:
* Engine-core
* API
* Admin Portal
* User Portal

=== Open Issues ===
'''Suggested naming alternatives''':<BR>
* ipv4_addresses --> inet
* ipv6_addresses --> inet6

[[Category: Feature]]
