{{autolang|base=yes}}

<!-- The actual name of your feature page should look something like: Features/YourFeatureName.  This keeps all features in the same namespace -->
= Adding External Events to Audit Log  =

== Summary ==
<!-- A sentence or two summarizing what this feature is and what it will do.  This information is used for the overall feature summary page for each release. -->
Currently all events audited in system are internal events. That means that all events are inserted to the Audit Log by the application. <br>
This document describes a requirement to enable injection of External Events to the system via API.<br>

== Owner ==
<!--This should link to your home wiki page so we know who you are-->
* Feature owner: [[User:emesika| Eli Mesika]]
:* GUI Component owner: [[User:emesika| Eli Mesika]]
:* REST Component owner: [[User:emesika| Eli Mesika]]
:* Engine Component owner: [[User:emesika| Eli Mesika]]
:* QA Owner: [[User:ykaul| Yaniv Kaul]] 

<!-- Include you email address that you can be reached should people want to contact you about helping with your feature, status is requested, or  technical issues need to be resolved-->
* Email: emesika@redhat.com

== Current status ==
* Target Release: 3.2
* Status: Design
* Last updated date: Nov 8 2012

== Detailed Description ==
<!-- Provide the details of the feature. What is it going to include. See the sections below. -->
<!-- New entities and changes in existing entities. -->
Enable plug-ins to inject their own events to the system using API<br>
This will be done by adding a new ''AddExternalEvent'' command and expose it to teh REST API<br>
External events should be displayed in displayed in the Events tab in UI and may be searched as any other event.<br>
External Events are classified as application events based on severity values of NORMAL, WARNING ERROR or ALERT<br>
This classification is displayed in UI by using a different icon for each<br>
It is recommended to add clones of existing icons for NORMAL, WARNING ERROR or ALERT with a different look to make it easy to distinguish visually between an application event and External Event.

== CRUD ==
Adding is_external boolean field to audit_log with a default value of ''false''<br>
Update relevant views to return the is_external flag.<br>

Adding a new configuration value that is exposed to engine-config named ExternalEventAgingThreashold<br>
This value controls when old events are deleted from the audit_log table and is defaulted to 30 days.<br>


=== DAO ===
Adding is_external to AuditLog BE<br>
Handling is_external in AuditLogDAODbFacadeImpl<br>
Modify DeleteAuditLogOlderThenDate sp to get also event type parameter (application/external)

=== Metadata ===
Modifying AuditLogDAOTest to include the added is_external field<br>
Adding is_external to fixtures.xml


== Configuration ==
Exposing ExternalEventAgingThreashold to  engine-config

== Business Logic == 
Adding the following types to AuditLogType
   EXTERNAL_EVENT_NORMAL  
   EXTERNAL_EVENT_WARNING 
   EXTERNAL_EVENT_ERROR   
   EXTERNAL_ALERT

Adding severities for the new types in AuditLogDirector<br>
Adding AddExternalEvent command<br>
Adding AddExternalEventParameters with the following fields
   AuditLogSeverity [Mandatory]
   Message [Mandatory]
   UserId [Optional]
   DataCenterId [Optional]
   StorageDomainId [Optional]
   ClusterId [Optional]
   HostId [Optional]
   VmId [Optional]
   TemplateId [Optional]
   GlusterVolumeId [Optional]



Adding the is_external keyword to the Search Engine to filter application/external events<br>

Change AuditLogCleanup logic to handle application & External cleanups<br>


=== Flow ===

== Permissions ==

=== Command Permissions ===

A new permission to access this command will be added by default only to superuser role. (Admin can add it to other custom roles)<br>

=== Permissions on Entities ===

Inject with single entity - requires permission for this action on the relevant entity).<br>
Inject with multiple entities - need to check the permission for each entity.<br>
Inject with no entity - requires system level permission to inject.<br>
(this by default would only be in super user role.)

== API ==
<!-- describe changes in REST API and SDK -->
We will use the existing events URL (.../api/events) and the existing Event business-entity in the API and open the possibility to add (POST) a new event (engine will off course impose permissions check on this operation). <br>

1) Add REST-->Backend mapping in EventMapper (right now only the other direction exists).<br>
2) Add add() method declaration to EventsResource (this is the interface)<br>
3) Add add() method implementation to BackendEvenetsResource (take example of creation implementation in BackendHostsResource)<br>
4) Add signatures to meta-data file (rsdl_metadata_v-3.1.yaml)<br>
5) Add tests<br>
''Note that no update or delete are required.<br>''

== User Experience ==
<!-- Describe user experience related issues. For example: We need a wizard for ...., the behaviour is different in the UI because ....., etc. -->

User should be able to use the keyword is_external when searching for events<br>
Event Tab display External Events using a new set of icons for NORMAL, WARNING ERROR and ALERT<br>

Global External Events will be displayed on the Global Events TAB<br>
Entity instance External Events will be displayed on the Events TAB when selecting the Entity instance<br>

== Installation/Upgrade ==
<!-- Describe how the feature will effect new installation or existing one. -->

=== User work-flows ===
<!-- Describe the high-level work-flows relevant to this feature. -->

== Enforcement ==


== Dependencies / Related Features and Projects ==
<!-- What other packages (RPMs) depend on this package?  Are there changes outside the developers' control on which completion of this feature depends?  -->
=== Affected oVirt projects ===

== Documentation / External references ==
<!-- Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs. -->

[https://bugzilla.redhat.com/show_bug.cgi?id=866123 RFE1]<br>
[https://bugzilla.redhat.com/show_bug.cgi?id=873223 RFE2]<br>

[[Features/ExternalEvents]]

== Open Issues ==
<!-- Issues that we haven't decided how to take care of yet. These are issues that we need to resolve and change this document accordingly. -->

=== Notifications ===
Should the new External Event types be exposed to the engine-notification tool?<br> 

=== Resetting an Alert ===
How an external ALERT disappears from the system after problem is resolved.<br>
Options:<br>

  Support EXTERNAL_ALERT_ON EXTERNAL_ALERT_OFF
  Have a time period for each ALERT and clean the ALERT when this time is passed.
  

[[Category: Feature]]
