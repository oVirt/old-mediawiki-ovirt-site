= Fencing refactoring =
{{Feature|name=Fencing refactoring|modules=engine|status=In Progress|version=3.6.0}}

== Summary ==
The goal of this fencing refactoring is to clean up the code and provide missing features in several fencing related parts of engine:
* Power Managements Agents
** Enable more than 2 power management agents  for a host
** Fix REST API to provide same power management agent editing feature as UI
* Non Responding Treatment
** Make SSH Soft Fencing part of Non Responding Treatment
** Provide ability to enabled/disable SSH Soft Fencing, Kdump integration and Power Managent Restart per host

== Owner ==
* Ori Liel <oliel@redhat.com>
* Martin Pe≈ôina <mperina@redhat.com>

== Detailed Description ==
=== Power Management Agents ===
TBD

=== Non Responding Treatment ===
Non Responding Treatment will be refactored in 3.6:
* It will be executed for any host when host status is changed to '''NonResponsive''' (in oVirt <= 3.5 SSH Soft Fencing  execution is enabled for all hosts and Non Responding Treatment execution is enabled only for hosts with '''Virt''' capabilities).
* The delay between host status '''Up''' is changed to '''NonResponsive''' is defined on page [[Automatic_Fencing#Automatic_Fencing|Automatic Fencing]].
* Non Responding Treatment will contain by default 3 steps (they can be enabled/disabled per host):
*# SSH Soft Fencing
*# Kdump Detection
*# Host restart using Power Management agents

==== Database structure ====
To hold information about Non Responding Treatment steps '''nrt_flow_steps''' with those fields:
{| class="wikitable"
! style="text-align:left;"| Name
! style="text-align:left;"|Type
! style="text-align:left;"|NULL
! style="text-align:left;"|PK
! style="text-align:left;"|Description
|-
| step_name
| VARCHAR(25)
| N
| Y
| One of ''SSH'', ''KDUMP'', ''PM''
|-
| vds_id
| UUID
| N
| Y
| Existing host ID
|-
| step_order
| SMALLINT
| N
| N
| Order of the step
|-
| step_enabled
| BOOLEAN
| N
| N
| 
|}
Each host will own one record in this table, which will be created during 1st host deploy or during oVirt upgrade. Also during oVirt upgrade value of existing column ''vds_static.pm_detect_kdump'' will converted into ''KDUMP'' step in ''nrt_flow_steps''.

==== Webadmin UI ====

==== REST API ====

== Testing ==
TBD

[[Category:Feature]]
[[Category:oVirt 3.6 Proposed Feature]]
