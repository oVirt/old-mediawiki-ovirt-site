<!-- {{autolang|base=yes}} -->

== Clone VM from Snapshot ==

=== Summary ===
The feature will allow oVirt users to clone VM from a snapshot of another VM. <BR>
A clone from snapshot will create disks at destination VM that are a collapsed copy of the images at snapshot chain (the start of the chain is the first snapshot, the end of the chain is a the selected snapshot) <BR>

Main feature page can be found at: [[Features/CloneVmFromSnapshot]]

=== Owner ===
* Name: [[User:Yair Zaslavsky| Yair Zaslavsky]]

* Email: <yzaslavs@redhat.com>


=== Current status ===
* Target Release: ...
* Status: In progress 
* Last updated date: Jan 18th, 2012


=== Detailed Description ===
Clone VM from Snapshot will give the ability to perform a clone of a VM , based on a snapshot of a given VM. <BR> 
oVirt-engine core will copy and collapse the images in the snapshot chain (the chain begins with the 1st snapshot, and ends with the selected snapshot). <BR><BR>
In order to provide information on the VM to be created for the UI, UI will execute a query that will retrieve the VM and its disks configuration given a snapshot ID. <BR>
The UI will use the retrieved configuration as default values for the user to be modified. <BR>

==== Entity Description ====

==== CRUD ====

==== User Experience ====
<!-- Describe user experience related issues. For example: We need a wizard for ...., the behaviour is different in the UI because ....., etc. -->
<!-- GUI mockups should also be added here to make it more clear -->
The UI will run a query called GetVmConfigurationBySnapshotID in order to get a VM configuration for a given snapshot.
The UI should present a window holding the configuration data. The configuration data will be used as defaults for the user, and the user may alter the data.
The UI should present the disks list.
The UI should allow to select different storage domains to hold the disks created upon clone, and to select different disks types and format.

<!--GUI mockups should also be added here to make it more clear -->

==== Installation/Upgrade ====
<!-- Describe how the feature will effect new installation or existing one. -->
Describe how the feature will effect new installation or existing one.

==== User work-flows ====
<!-- Describe the high-level work-flows relevant to this feature. -->
Example of flow (assuming a VM was created with two disks): <BR>
[[File:Clone flow 1.jpg]]<BR>
The next figure shows a snapshot was made, having now two images serving as the active images: <BR>

<BR>[[File:Clone flow 2.jpg]]<BR>
In a similar way, more snapshots are created (Snaphost2 will be the one used for performing the clone): <BR>
<BR>[[File:Clone flow 3.jpg]]<BR>


The Clone from snapshot will be performed the following way: <BR><BR>

.1. A user selects snapshot2 and selects a "clone from snapshot" operation from UI. <BR>
.2. oVirt-engine core queries for VM configuration, providing the VM configuration as default values for the user to use in order to provide the new VM information. <BR>
.3. The user will override the default data values (the user will have to provide a new name. UI will suggest a new name in a format of "copy_of_OLD_NAME") <BR>
.4. The user will initiate the beginning of the clone operation.<BR>
.5. New VM entity based on the passed data will be created. Some VM related data will be cloned from the original VM (i.e NICs) <BR>
.6. Copy & collapse all images at snaphsot2 and their ancestors will be carried out by oVirt-engine<BR>
.7. Association the copies of the disks with the VM clone will be created<BR><BR>

This can be seen in the next figure:<BR>
<BR>[[File:Clone flow 4.jpg]]<BR>




==== Events ====
1. In case a snapshot is performed , and one of the disks is erased from the original VM, cloning from the snapshot 
should report that the disk is missing using the audit log.

=== Dependencies / Related Features and Projects ===

The feature depends on the following projects: <BR>
1. oVirt web-admin - to supply the UI parts for this feature <BR>
2. oVirt API - to supply REST modeling <BR><BR>
The feature depends on the following features: <BR>
1. Stable device addresses - on introduction of VM devices, which will have to be a part of the clone <BR>
2. Multiple storage domains - on introduction of multiple storage domains <BR>
3. Live snapshots - on introducing of snapshot entity and the association of snapshot and VM configuration (needed for querying VM configuration by snapshot) <BR>
4. Direct LUN -on introduction of LUN-based disks (maybe this can postponed for later phase). <BR>
5. Hot plug/unplug - this feature may depend on hot plug/unplug - see open issues section <BR><BR>

Add a link to the feature description for relevant features.
Does this feature effect other oVirt projects? Other projects?

=== Documentation / External references ===
<!-- Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs. -->
Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs.

=== Comments and Discussion ===
Add a link to the "discussion" tab associated with your page.  This provides the ability to have ongoing comments or conversation without bogging down the main feature page

=== Open Issues ===
1. Behavior of clone of Direct-Luns based disks and of shared disks - <BR>
Automatically attaching these disks may yield to data corruption, if both source VM and destination VM are up. <BR>
If we ignore cloning these disks, the cloned VM will not have these disks. <BR>
A suggestion was raised to mark these disks as unplugged at cloned VM, allowing the administrator to decide whether to plug it or not. <BR>
[[Category:Template]]
[[Category:Feature]]
