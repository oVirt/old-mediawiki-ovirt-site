<!-- {{autolang|base=yes}} -->

== Introduce Messaged communication to VDSM using JSON-RPC on top of various transport protocols ==

{{Feature|name=Introduce Messaged communication to VDSM using JSON-RPC on top of various transport protocols|modules=vdsm, engine|status=In Development|version=3.5.0}}

=== Summary ===
Using a phased approach we are going to move VDSM to a point where messaging is the main communication model between the engine and VDSM as well as the numerous VDSM subsystems.

=== Owner ===

* Name: [[User:smizrahi| Saggi Mizrahi]]
* Email: <smizrahi@redhat.com>

=== Current status ===
* Last updated on {{REVISIONYEAR}}-{{REVISIONMONTH}}-{{REVISIONDAY2}} by [[User:{{urlencode:{{REVISIONUSER}} | WIKI}}]] <!--This is markup for the date on which the current page was last changed, do not change-->
* Were currently in [[#Phase_1|Phase 1]]

=== Phases ===

==== Phase 0 ====
The is how VDSM communicated with the engine before any messaging was implemented.

[[File:jsonrpc_phase0.png]]

The engine uses XML-RPC over HTTP to make API requests.

==== Phase 1 ====
This is an phase not meant to be released in any version. Instead it it is meant to be used in development so integration with the engine could start.

VDSM would listen in a different port for each supported transport.
Messages are parsed by the appropriate transport reactor and the message boydy is passed to the JSON-RPC Server.
The Server than parses the json data and calls the appropriate method on the bridge that maps to the vdsm object responsible for performing the command.

[[File:jsonrpc_phase1.png]]

==== Phase 2 ====
'''in progress'''

For this phase the main addition is protocol detection.
Instead of having a dedicated port per protocol the protocol detector handles SSL negotiation and peeks at the stream. After detecting the protocol it passes the socket to the correct part of the system.

This is going to be released for 3.5

[[File:jsonrpc_phase2.png]]

==== Phase 3 ====

The main edition for this phase is the broker.
Up until this point the messaging reactors "faked" having a brokering semantics.
This change adds an actual entity with brokering semantics.

Broker Features:
* Topics
* Subscriptions

Low Priority Features:
* Queues
* Message acknowledgment\settlement
* Retrying policy


There is a possibility this phase would be skipped and we would just use a ready made broker.

[[File:jsonrpc_phase3.png]]

==== Phase 4 ====

At this point Subsystems would start managing their own topics. There would still be the legacy interface but there will be a move towards a segmented and seperate task management per subsystem.

[[File:jsonrpc_phase4.png]]

==== Phase 5 ====

At this point the broker will be pulled out (if we are not already using a standard broker. We remove the XML-RPC interface entirely and more subsystems are being seperated.

Hopefully some subsystems are even running in their own processes.

[[File:jsonrpc_phase5.png]]

=== See also  ===

* [http://stomp.github.io STOMP]
* [http://www.jsonrpc.org/ JSON-RPC]
* [http://www.amqp.org/ AMQP]
