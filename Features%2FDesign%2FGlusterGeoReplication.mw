== Summary ==
This document describes the design for geo replication feature under gluster. For overview of this feature, refer [[Features/Gluster_Geo_Replication]]

== Design ==
Geo-replication feature is designed to enable creation and maintenance of geo-replication sessions across clusters in GlusterFS. A geo-replication session can be setup between a GlusterFS managed source cluster and remote (destination) GlusterFS managed cluster.

=== Entity Description ===

====  Gluster Geo Replication Destinations ====
This entity stores the details of remote (destination) for a geo-replication setup. While creation of a geo-replication session if it is first time that the geo-replication session is being setup being the source and destination cluster then an entry in maintained as part of this entity. For further geo-replication sessions the existing entry if referred for details.
{| class="wikitable"
|+ gluster_geo_rep_destinations
!Column name !! Type !! description
|-
|  Id || UUID  || Primary Key
|-
|  Vds_Group_Id || UUID  || Id of the Source Cluster
|-
| Server_Id || UUID || Host of the Source Cluster
|-
| Destination_Host_IP || String || Host part of remote/destination cluster
|-
| Destination_SSH_Fingerprint || String || SSH key fingerprint of destination host
|-
| Connection_Status || String || Password less connection status between source node and destination node
|}

==== Gluster Geo Replication Sessions====
This entity stores the details of the individual geo-replication sessions
{| class="wikitable"
|+ gluster_geo_rep_session
!Column name !! Type !! description
|-
|  Id || UUID  || Primary Key
|-
| Destination_id || UUID || References Id of gluster_geo_rep_destinations
|-
| Volume_id || UUID || References Id of gluster_volumes
|-
| Destination_Volume || String || Name of the volume in destination cluster
|}

==== Gluster Geo Replication Session Status ====
This entity stores the status of individual geo-replication sessions maintained in oVirt engine

{| class="wikitable"
|+ gluster_geo_rep_session_status
!Column name !! Type !! description
|-
|  Id || UUID  || Primary Key
|-
| Session_id || UUID || References Id of gluster_geo_rep_session
|-
| Server_id || UUID || Host in the source cluster
|-
| Status || String || Valid values STABLE,  FAULTY, INITIALIZING, NOT_STARTED
|}

==== Gluster Geo Replication Session Config ====

Refer the URL http://www.ovirt.org/Features/Entity_Configuration_Management for more details on configuration maintenance.

=== REST APIs ===
The details of the REST for gluster geo-replication feature are as below -

==== Listing APIs ====
* api/clusters/{id}/geo-replication-destinations - lists all the geo-replication destinations from current cluster
Output:
<pre>
<geo-replication-destinations>
  <geo-replication-destination>
    <id>geo replication destination id</id>
    <cluster>Cluster Id</cluster>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
  </geo-replication-destination>
  <geo-replication-destination>
    <id>geo replication destination id</id>
    <cluster>Cluster Id</cluster>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
  </geo-replication-destination>
</geo-replication-destinations>
</pre>

* api/clusters/{id}/geo-replication-destinations/{geo-rep-destination-id} - lists the details of the individual geo-replication destination
Output: 
<pre>
  <geo-replication-destination>
    <id>geo replication destination id</id>
    <cluster>Cluster Id</cluster>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
  </geo-replication-destination>
</pre>

* api/volumes/{id}/geo-replication-sessions - lists all the geo-replication sessions for the current volume
Output:
<pre>
<geo-replication-sessions>
  <geo-replication-session>
    <id>geo replication session id</id>
    <volume>source volume id</volume>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
    <destination_volume>destination volume id</destination_volume>
    <status>Stable/Faulty/Initializing/Not Started</status>
  </geo-replication-session>
  <geo-replication-session>
    <id>geo replication session id</id>
    <volume>source volume id</volume>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
    <destination_volume>destination volume id</destination_volume>
    <status>Stable/Faulty/Initializing/Not Started</status>
  </geo-replication-session>
</geo-replication-sessions>
</pre>

* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id} - lists the detail of an individual geo-replication session
Output:
<pre>
  <geo-replication-session>
    <id>geo replication session id</id>
    <volume>source volume id</volume>
    <source_host>Source Host Id</source-host>
    <destination_host>Destination Host Id</destination_host>
    <destination_volume>destination volume id</destination_volume>
    <status>Stable/Faulty/Initializing/Not Started</status>
  </geo-replication-session>
</pre>

* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/configurations - lists all the configurations for a geo-replication session
Output:
<pre>
<geo_replication_configurations>
  <configuration>
    <id>Configuration Id</id>
    <configuration_name>Name of the configuration</configuration_name>
    <configuration_value>Value of the configuration</configuration_value>
  </configuration>
</geo_replication_configurations>
</pre>

* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/configurations/{config-id} - shows the details of an individual configuration for a geo-replication session
Output:
<pre>
  <configuration>
    <id>Configuration Id</id>
    <configuration_name>Name of the configuration</configuration_name>
    <configuration_value>Value of the configuration</configuration_value>
  </configuration>
</pre>

==== Actions Supported ====

* api/clusters/{id}/create-geo-rep-destination - creates a new geo-replication destination for the cluster
** Parameters
*** source_host - uuid
***destination_host - uuid
*** destination_root_passwd - string
Input:
<pre>
<action>
  <source_host>Source Host Id</source_host>
  <destination_host>Destination Host Id</destination_host>
  <destination_root_passwd>Destination Host root password</destination_root_passwd>
</action>
</pre>

* api/clusters/{id}/geo-replication-destinations/{geo-rep-destination-id}/remove - Removes the given geo-replication destination
* api/clusters/{id}/geo-replication-destinations/{geo-rep-destination-id}/reestablish - reestablishes the communication between geo-replication source-destination
* api/clusters/{id}/geo-replication-destinations/{geo-rep-destination-id}/test - checks the validity of communication between geo-replication source-destination

* api/volumes/{id}/create-geo-rep-session - Creates a new geo-replication session for the volume
** Parameters
*** destination_host
*** destination_volume
Input:
<pre>
<action>
  <destination_host>Destination Host Id</destination_host>
  <destination_volume>Destination Volume Id</destination_volume>
</action>
</pre>

* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/start - starts the given geo-replication session
* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/stop - stops the given geo-replication session
* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/remove - removes the given geo-replication session
* api/volumes/{id}/geo-replication-sessions/{geo-rep-session-id}/set-config - sets a configuration value for a geo-replication session
** Parameters
*** configuration_name - string
*** configuration_value - string
Input:
<pre>
<action>
  <configuration_name>Name of the configuration</configuration_name>
  <configuration_value>Value of the configuration</configuration_value>
</action>
</pre>

[[Category:Feature|Gluster Geo Replication]]
[[Category:oVirt 3.6 Proposed Feature|Gluster Geo Replication]]
