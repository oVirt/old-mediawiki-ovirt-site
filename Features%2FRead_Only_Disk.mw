<!-- {{autolang|base=yes}} -->

== Read Only Disk <!-- The name of your feature --> ==

=== Summary ===
<!-- A sentence or two summarizing what this feature is and what it will do.  This information is used for the overall feature summary page for each release. -->
VDSM already has a read-only disk capability. This feature  adds that functionality to the engine as well.

=== Owner ===
<!--This should link to your home wiki page so we know who you are-->
* Name: [[User:vvolansk|Vered Volansky]]
* Email: vered@redhat.com

=== Current status ===
* Target Release: 3.2
* Status: work in progress
* Last updated: 06:05, 23 December 2012 (GMT)

=== Detailed Description ===
<!-- Expand on the summary, if appropriate.  A couple sentences suffices to explain the goal, but the more details you can provide the better. -->
When adding/attaching a disk to a vm,  add a property of RO.  The RO property is not a disk property. It's a property of the VM-Disk relationship, and therefore is persisted through VMDevice (vm_device in the DB). A shareable disk could be attached to one VM as RO, and to another as RW. This is the case as long as the disk is not qCow. qCow disks currently cannot be shared. When that'll change, it shouldn't be allowed to attach a RW qCow disk to one VM while attaching it as RO to another. 

====DB====
vm_device table already has a read_only column. No update to the DB is needed.

====Backend====
AddDiskCommand,  AttachDiskToVmCommand - Add the RO property and propagate until VMDevice creation.<br/>
All relating Parameters classes should now contain this info. Therefore,  VmDiskOperationParameterBase will be added a new readOnly data member.<br/>
ImagesHandler.addDiskToVm() -  will get the RO data and propagate it.<br/>

No changes need in:<br/>
HotPlugDiskToVmCommand<br/>
UpdateVmDiskCommand<br/>
DetachDiskFromVmCommand<br/>
CreateCloneOfTemplateCommand<br/>
AddVmTemplateDevice<br/>
AddVmFromTemplateCommand<br/>
CreateSnapshotFromTemplate<br/>
AddVmFromSnapshotCommand<br/>
AddVmAndCloneImageCommand<br/>
OvfReader.readVmDevice() (already reads the readOnly property).<br/>
OvfWriter.writeVmDeviceInfo() (already writes the readOnly property).<br/>

=====Templates=====
Currently templates will maintain the current disk RO property value with no editing option.<br/>
When creating a VM from template, it's disks will inherit the disk RO property value with no editing option.<br/>
Editing options to both phases can be added later on.<br/>
This is an open issue, please comment if you think this should be dealt with in another way.<br/>

=====Snapshots=====
There's no need to save the images of RO disk to the images table.<br/>
There is, however, a need to update the ovf file so that it does include the RO disks' (images).<br/>
Verified - the OvfReader does read the RO property, so no problem with snapshots uses.<br/>

====UI====
Changes will have to be made to RESTapi and uicommon in order to get the RO property value from the user.

=== Benefit to oVirt ===
<!-- What is the benefit to the oVirt project?  If this is a major capability update, what has changed?  If this is a new feature, what capabilities does it bring? Why will oVirt become a better distribution or project because of this feature?-->
This features allows the usage of read only disks. This is useful where we'd like to expose the data but don't want it to be altered.  This is a new feature in the engine, allowing the attachment of a disk to a VM to be done with read only rights.  A shareable disk could be attached to one VM as RO, and to another as RW. 

=== Comments and Discussion ===

* Refer to [[Talk:Features/Read Only Disk]]  <!-- This adds a link to the "discussion" tab associated with your page.  This provides the ability to have ongoing comments or conversation without bogging down the main feature page -->

[[Category:Feature]]
