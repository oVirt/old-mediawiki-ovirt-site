<!-- {{autolang|base=yes}} -->
== Refresh LUN Size==
{{Feature|name=Refresh LUN Size|modules=engine/vdsm|status=Design|version=3.6.0}}

=== Summary ===
Support dynamic increase of data domain LUNs in oVirt.

=== Owner ===
* [[User:Frolland| Fred Rolland]] (<frolland@redhat.com>)
* [[User:NirSoffer|Nir Soffer]] (<nsoffer@redhat.com>)

=== Detailed Description ===
Users need the ability to increase storage space available in oVirt data domains without increasing the number of LUNs presented to it.

A storage admin resizes a LUN using some administrative tool. (This is out of our scope)<br />
The oVirt admin will be able to perform a UI action on specific LUNs in a storage domain so that the new size will be refreshed.

For each LUN, the engine will send to all hosts in Data Center a  "refresh device" command.<br />
If all hosts return the same size, the engine will  send to SPM  a "resize PV" command.<br />
The DB will be updated with new sizes if needed.<br />
Finally the engine will send to all other hosts in DC command a "refresh PV" command

==== User Experience ====
In the "Edit Domain" window, a new column "Additional Size" will be available.
If the LUN can be expanded , a toggle button with the additional size available will be column.
The user can choose to select the button on the LUN he wants to refresh and then click OK.

[[File:DomainRefreshLun.jpg]]

==== Vdsm ====
The following verbs will be added:<br />
* Refresh Device
:input  : a single LUN GUID
:output : size of LUN
:action : call multipath-resize utility and return LUN size
* Resize PV
: input :  a single LUN GUID
: output : size of LUN
: action : call pvresize and return the size of the LUN
* Refresh PV
:input  : a single LUN GUID
:output : void
:action :  refresh PV by invalidate PV cache

==== Engine ====
A new command will be added:
* RefreshLunSize
:input  : a list of LUN GUIDs
:output : status of operation
:action :  send to all hosts in Data Center a  "refresh device" command. If all hosts return the same size, the engine will  send to SPM  a "resize PV" command. The DB will be updated with new sizes if needed. Finally the engine will send to all other hosts in DC command a "refresh PV" command

==== REST ====
The user will able to perform LUN resize using the REST API of update Storage Domain.
[TBD]

=== Open Issues ===
How to handle a host that was in maintenance  when this operation has been performed?
Should we refresh luns when the host is coming out of maintenance ?<br />
How to handle a host that was not reachable when the operation was performed ?<br />
What if the host used for getDeviceList do not see the new LUN size? Currently in Edit Domain , the "Use Host" is disabled and the user cannot choose a different one.



[[Category:Feature|LUN_Resize]]
[[Category:oVirt 3.6 Proposed Feature|LUN_Resize]]
