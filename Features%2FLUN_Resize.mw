<!-- {{autolang|base=yes}} -->
== Refresh LUN Size==
{{Feature|name=Refresh LUN Size|modules=engine/vdsm|status=Design|version=3.6.0}}

=== Summary ===
Support dynamic increase of data domain LUNs in oVirt.

=== Owner ===
* [[User:Frolland| Fred Rolland]] (<frolland@redhat.com>)
* [[User:NirSoffer|Nir Soffer]] (<nsoffer@redhat.com>)

=== Detailed Description ===
Users need the ability to increase storage space available in oVirt data domains without increasing the number of LUNs presented to it.

A storage admin resizes a LUN using some administrative tool. (This is out of our scope)
The oVirt admin will be able to perform a UI action (TBD) on specific LUNs in a storage domain.

For each LUN, the engine will send to all hosts in Data Center a  "rescan device" command.
If all hosts return the same size, the engine will  send to SPM  a "resize PV" command.
The DB will be updated with new sizes if needed.
Finally the engine will send to all other hosts in DC command a "refresh PV" command


 ====Engine API - UI/REST ====

- refreshPvSize
                - input  : - storage domain ID
                           - list of LUNs GUID
                - action : - take exclusive lock on SD
                           - for each LUN:
                            - send to all hosts in DC rescanDevice
                            - if all hosts return the same size:
                                - send to SPM command resizePV
                                - send to all other hosts in DC command refreshPV
                                - update DB with sizes if needed
                - error handling : log

 ====VDSM ====

- Hosts : rescanMultipathDevice :
               - input  : a single LUN GUID
               - output : size of LUN
               - action : - use Nir utility [3]
                          - return LUN size

- Hosts : refreshPV :
               - input  : a single LUN GUID
               - output : void
               - action : refresh PV by invalidate PV cache

- SPM : resizePV :
               - input :  a single LUN GUID
               - output : size of LUN
               - action : call pvresize and return the size of the LUN



==== User Experience ====
<!-- Describe user experience related issues. For example: We need a wizard for ...., the behaviour is different in the UI because ....., etc. -->
<!-- GUI mockups should also be added here to make it more clear -->
Describe user experience related issues. For example: We need a wizard for ...., the behaviour is different in the UI because ....., etc.
GUI mockups should also be added here to make it more clear

==== Installation/Upgrade ====
<!-- Describe how the feature will effect new installation or existing one. -->
Describe how the feature will effect new installation or existing one.

==== User work-flows ====
<!-- Describe the high-level work-flows relevant to this feature. -->
Describe the high-level work-flows relevant to this feature.

==== Events ====
<!-- What events should be reported when using this feature. -->
What events should be reported when using this feature.

=== Dependencies / Related Features and Projects ===
<!-- What other packages depend on this package?  Are there changes outside the developers' control on which completion of this feature depends?  In other words, completion of another feature owned by someone else and might cause you to not be able to finish on time or that you would need to coordinate? Other Features that might get affected by this feature? Add a link to the feature description for relevant features. -->

What other packages depend on this package?  Are there changes outside the developers' control on which completion of this feature depends?  In other words, completion of another feature owned by someone else and might cause you to not be able to finish on time or that you would need to coordinate? Other Features that might get affected by this feature?

Add a link to the feature description for relevant features.
Does this feature effect other oVirt projects? Other projects?

=== Documentation / External references ===
<!-- Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs. -->
Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs.

=== Comments and Discussion ===
Add a link to the "discussion" tab associated with your page.  This provides the ability to have ongoing comments or conversation without bogging down the main feature page

=== Open Issues ===
<!-- Issues that we haven't decided how to take care of yet. These are issues that we need to resolve and change this document accordingly. -->
Issues that we haven't decided how to take care of yet. These are issues that we need to resolve and change this document accordingly.



[[Category:Feature|LUN_Resize]]
[[Category:oVirt 3.6 Proposed Feature|LUN_Resize]]
