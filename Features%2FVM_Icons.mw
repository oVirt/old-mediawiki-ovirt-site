

=VM Icons=

{{Feature|name=VM Icons|modules=engine|status=Design|version=3.6.0}}

==Summary==

It allows users to add icon to VMs and Templates in order to customize the appearance of these entities in userportal.

==Owner==

* Name: [[User:jniederm|Jakub Niedermertl]]
* Email: [mailto:jniederm@redhat.com jniederm@redhat.com]

==Status==

* Design
* Last updated on 2015-1-19 by [[User:jniederm|Jakub Niedermertl]]
* Target release: 3.6

==Description==

User can optionally add arbitrary image (limited in dimensions, size, and format) - icon - to VM and Template entities. Icons are stored in new separate DB table  'vm_icons'. Rows of this table are referenced from 'vm_static' table. 

Currently used default icons (assigned according to OS) will also be stored in 'wm_icons' table. Thus this system fully replace current approach of storing and providing icons - GWT ClientBundles and ImageResources.

===Icon inheritance===
* When new Template is created, it inherits icon from VM it is based on.
* When new VM is created, it inherits icon from Template it is based on.
* When new Pool is created, it inherits icon from Template it is based on.
* When new VM in Pool is created, it inherits icon from Pool it belongs to.

===Pools===
* Similarly to other VM parameters user can't directly edit icon of pool or icons of VMs attached to a Pool. To update icon of a Pool one can create a Template with desired icon and then create new Pool based on that Template, or provided that the Pool is based on latest template version, create new version of base Template with desired icon.
* When icon of a pool is updated, icons of all attached VMs are also updated to the same icon.

==Design==

* Supported image formats are: jpg, png, gif
* Maximum dimensions are 150px <small>x</small> 120px (w <small>x</small> h) (based on Userportal > Basic icons)
* Maximum size is 24kB (limit imposed by IE8)
* Icons are transferred and stored in dataUrl format.
* Icons are cached in browser based on their hashes  in order to save network resources during listing updates. 

===UI===

* Show icons in Userportal > Basic, Userpotal > Extended > Virtual Machines, Templates.
* Add icon editing and validating tab to 'New VM', 'Edit VM' and 'Edit Template' dialogs.
* Create per-session cache of Icons: Map<String, String> iconHash -> icon

===Backend===

* Extend commands saving VMs and templates to be able to validate and store icon.
* Extend queries for fetching VMs and templates by additional parameter to be able to provide either icon and its hash or icon hash only.
* Create new query to to separately fetch icon of certain <code>VmBase</code>d entity.
* Extend model VmBase by <code>String icon</code> property and <code>String iconHash</code> property

===Database===

* New nullable column 'icon' of type 'character varing' in table 'vm_static'
* New nullable column 'icon_hash' of type 'character' in table 'vm_static'
* 'vm_static' table stores VMs, Templates, Pools and Instance types. Content of two aforementioned columns is relevant only for  VMs, Templates and Pools.

===Compatibility issues===

Proposed design requires following browser 'HTML5' features:
* dataURL, IE8 limits content size to 24kB, IE9 full support
* File API (File and FileReader objects), since IE10

Current minimal supported version of IE:
* webadmin: 9
* userportal: 8

Hence the functionality can't be fully implemented for all supported browsers. Proposed solution:
* Limit the icon size to 24kB. It should be ok for jpg, gif and 'iconic' graphic in png. It can sometimes cause problem for 'photographic' png. This restriction allows to '''display''' VM Icons on all supported browsers. Canvas based automatic resize and png -> jpg conversion and be added to help mitigate size limit.
* Implement '''editing''' of VM Icons only for IE10+ and other browser using differed binding <code>replace-with</code> tag. Editing functionality (side tab in dialogs) wouldn't be visible in IE8 and IE9.
* Flash base polyfill can be later used for IE8 and IE9, e.g. [http://html5please.com/#file].

[[Category:Feature|VM Icon]]
[[Category:oVirt 3.6 Proposed Feature|VM Icon]]
