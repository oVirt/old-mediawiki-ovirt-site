<!-- {{autolang|base=yes}} -->

== Otopi Infra Migration ==

=== Summary ===
A complete re-write of engine-setup, engine-cleanup, engine-upgrade and AIO plugin using otopi.

=== Owner ===
* Name: [[User:Alonbl|Alon Bar-Lev]]
* Email: <alonbl@redhat.com>

* Name: [[User:Alourie| Alex Lourie]]
* Email: <alourie@redhat.com>

* Name: [[User:SandroBonazzola| Sandro Bonazzola]]
* Email: <sbonazzo@redhat.com>

=== Current status ===

* Last updated: {{CURRENTMONTHNAME}} {{CURRENTDAY}}, {{CURRENTYEAR}}<!--This is markup for current date, do not change-->

==== engine-setup ====
{| class="wikitable" border="1"
|-
! Feature
! Existing implementation
! Otopi implementation
! Owner
|-
| Verify that root is the user executing the script
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Allow unprivileged user ro run a development installation
|style="background-color: red;"| Not implemented
|style="background-color: lightgreen;"| Done
|
|-
| Checking total memory
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Generate answer file
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Allow logging
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Support AIO plugin
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support FIREWALL_MANAGER option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support OVERRIDE_HTTPD_CONFIG option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support HTTP_PORT option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support HTTPS_PORT option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support RANDOM_PASSWORDS option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Overriding given passwords with random
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support MAC_RANGE option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support HOST_FQDN option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support AUTH_PASS option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support ORG_NAME option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support APPLICATION_MODE option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DC_TYPE option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_REMOTE_INSTALL option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_LOCAL_PASS option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_HOST option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_PORT option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_ADMIN option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_REMOTE_PASS option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support DB_SECURE_CONNECTION option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support NFS_MP option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support ISO_DOMAIN_NAME option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Support CONFIG_NFS option
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
| Display summary in interactive mode
|style="background-color: lightgreen;"| Done
|style="background-color:red;"| Not implemented
|
|-
|Initialize MiniYum
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
|Handle second execution warning
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Handle loading and validating params from answer file
|style="background-color: lightgreen;"| Done (--answer-file)
|style="background-color: lightgreen;"| Done (--config-append)
|
|-
| Mask input sets
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Log masked configuration
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Set Max Shared Memory
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Check for supported Java VM
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| CA Generation
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Extract CA fingerprint
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Extract non password key for log collector
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|-
| Extract non password key for Apache
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Extract SSH fingerprint
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Configure engine service - database
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Configure engine service - Java
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Configure engine service - Protocols
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Configure .pgpass file
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Encrypt DB Password
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Push the encrypted password into the local configuration file
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Start / Stop rhevm-etl service when needed
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Start / Stop rhevm-notifierd service when needed
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Upgrade engine database if already exist
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Install engine database if doesn't exist
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Set Application Mode (Both, Virt, Gluster)
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Update VDC Options
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Update default data center storage type
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure engine-log-collector
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure engine-iso-uploader
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure engine-image-uploader
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure PostgreSQL max_connections if using local DB
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure NFS exports for ISO Domain if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Allow importing existing NFS ISO Domain
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Create new NFS ISO Domain
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Migrate existing NFS ISO exports from /etc/exports to /etc/exports.d/
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Set selinux context for NFS ISO mount points
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| set NFS/portmap ports by overriding /etc/sysconfig/nfs
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Enable the rpcbind and nfs services
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Load files (iso,vfd) from existing rpms to ISO domain
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Check firewall managers installed in the system
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure and enable iptables if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure and enable FirewallD if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Start / Stop Engine service when needed
|style="background-color: lightgreen;"| Done
|style="background-color: lightgreen;"| Done
|
|-
| Enable httpd_can_network_connect selinux flag
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Backup old Apache httpd config when needed
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure Apache mod_ssl for using  engine apache keys
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure Apache for listening on requested HTTP port
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure Apache for listening on requested HTTPS port
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Configure Apache as proxy for the requests to the jboss service
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Enable the httpd service
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Enter rpm versions into yum version-lock
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Add info message to the user finalizing the  successful install
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Print additional message to the user finalizing the  successful install
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Log a summary of the parameters
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|}

==== engine-cleanup ====
{| class="wikitable" border="1"
|-
! Feature
! Existing implementation
! Otopi implementation
! Owner
|-
| Verify that root is the user executing the script
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Allow unprivileged user ro run a development cleanup
|style="background-color: red;"| Not implemented
|style="background-color: red;"| Not implemented
|
|-
| Support unattended-clean option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support dont-drop-db option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support dont-remove-ca option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support remove-nfs-exports option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Support remove-exported-content option
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Change working dir to the root directory
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Allow logging
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Ask user to proceed with cleanup in interactive mode
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Stop Engine service when needed
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Backup engine database if drop requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Drop engine database if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Clean pgpass  if drop requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Clean sysctl configuration
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Backup CA if remove requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Remove CA  if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Stop engine-notifierd when needed
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Clean ISO domain NFS exports if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Clean ISO domain exported directories if requested
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Add info message to the user finalizing the  successful cleanup
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|-
| Add info message on where the logs are located
|style="background-color: lightgreen;"| Done
|style="background-color: red;"| Not implemented
|
|}

=== Detailed Description ===
TBD


=== Benefit to oVirt ===
* Lower cost of maintenance. 
* Use of otopi API.
* More ...


=== Dependencies / Related Features ===
<!-- What other packages depend on this package?  Are there changes outside the developers' control on which completion of this feature depends?  In other words, completion of another feature owned by someone else and might cause you to not be able to finish on time or that you would need to coordinate? Other Features that might get affected by this feature? -->
TBD

=== Documentation / External references ===
* [[:File:ovirt-host-deploy 3.2.pdf|Ovirt Host Deploy Presentation]]
* [https://bugzilla.redhat.com/show_bug.cgi?id=911191 Bug 911191 - Migrate ovirt-engine-setup and AIO plugin to otopi]

=== Comments and Discussion ===
* Refer to [[Talk:Features/Otopi_Infra_Migration]] 

[[Category:Feature]]
