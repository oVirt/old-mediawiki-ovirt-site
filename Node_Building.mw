== Build Process for oVirt Node ==

Note:  This is a draft and still very much a work in progress.

Currently, we're heavily reliant on Fedora.

=== Get the Source ===

Use git

<code>$ git clone http://gerrit.ovirt.org/p/ovirt-node.git

$ cd ovirt-node</code>

=== Setup a Build Environment ===

* Recommend minimum F15 build host
** Otherwise there are problems with systemd and building
* Create an ovirt-cache directory (defaults to ~/ovirt-cache
* Create an RPM build environment
** If not running on the version of Fedora you want to build with, create a ~/.rpmmacros file with
*** %dist .fc16
*** %fedora 16
** If you're on the right version, then no need for .rpmmacros
** Create directory structure 
*** <code>$ BASEDIR=$(rpm --eval %_topdir) #to get base rpmbuild directory
*** mkdir -p $BASEDIR/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}</code>
* set OVIRT_CACHE_DIR and OVIRT_LOCAL_REPO environment variables
** <code> $ export OVIRT_CACHE_DIR=~/ovirt-cache
** $ export OVIRT_LOCAL_REPO=file://${BASEDIR}/RPMS </code>

=== Install Dependencies ===

* You will need (at least):
** at least sudo access to livecd-creator (preferably passwordless)
** livecd-tools
** appliance-tools-minimizer
** rpm-build
** createrepo

=== Build ovirt-node packages ===

* go to base ovirt-node location
* <code> $ ./autogen.sh --with-image-minimizer
* $ make
* rm *tar.gz
* make dist
* EXTRA_RELEASE=.$USER$(date +%s)
** Not required if you're building an official build
** Also, you may need to tweak this if you have an invalid character in your user name (like - )
* rpmbuild --nodeps --define "extra_release $EXTRA_RELEASE" -ta --clean *.tar.gz
</code>

=== Workarounds for RPMs not included in Fedora ===
* cd to your rpmbuild/RPMS directory
* copy all separate rpms there
* in the RPMS directory, run <code>$ createrepo .</code>

'''IMPORTANT NOTE'''
* There is currently 1 known override that needs to be applied
** VDSM rpms are not available in Fedora yet
*** Need to pull them down for ovirt-node to use
*** [http://fsimonce.fedorapeople.org/vdsm/ RPM Location]
* Download the packages from these locations and add them to the RPMS/x86_64 directory and re-run createrepo

=== Build the image ===

<code>

* $ cd recipe
* $ make ovirt-node-image.iso

</code>

[[Category:Node]]
[[Category:Documentation]]
