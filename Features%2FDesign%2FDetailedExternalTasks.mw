{{autolang|base=yes}}

<!-- The actual name of your feature page should look something like: Features/YourFeatureName.  This keeps all features in the same namespace -->
= Adding External Jobs/Steps Support =

== Summary ==
<!-- A sentence or two summarizing what this feature is and what it will do.  This information is used for the overall feature summary page for each release. -->
Enable plug-in to inject tasks (Jobs) to the engine application using the REST API, change their statuses and track them from the UI.
A task  (Job) may have other nesting sub-tasks (Steps) under it.

== Owner ==
<!--This should link to your home wiki page so we know who you are-->
* Feature owner: [[User:emesika| Eli Mesika]]
:* GUI Component owner: [[User:emesika| Eli Mesika]]
:* REST Component owner: [[User:emesika| Eli Mesika]]
:* Engine Component owner: [[User:emesika| Eli Mesika]]
:* QA Owner: [[User:ykaul| Yaniv Kaul]] 

<!-- Include you email address that you can be reached should people want to contact you about helping with your feature, status is requested, or  technical issues need to be resolved-->
* Email: emesika@redhat.com

== Current status ==
* Target Release: 3.3
* Status: Design
* Last updated date: APR 15 2013

== Detailed Description ==
<!-- Provide the details of the feature. What is it going to include. See the sections below. -->
<!-- New entities and changes in existing entities. -->
Enable plug-in to inject tasks (Jobs) to the engine application using the REST API, change their statuses and track them from the UI. A task (Job) may have other nesting sub-tasks (Steps) under it. 
A Job is actually a container of nexted steps. each Step may have sub-steps under it. 
A steps represents one of the following:<br>
   An external command that is invoked and monitored by the plug-in
   A supported internal command that is invoked by the plug-in and monitored internally by the oVirt engine.

Each Job may have unlimited list of external/internal steps.

The following should be supported:
   Adding a job
   Adding a  step to a job or to a step (as sub-step)
   Ending a step 
   Eding a job
   Displaying all Jobs
   Displaying a specific Job
   Displaying all Steps under a specific Job
   Dislaying a specific Step under a Job

Job can be in one of the following statuses:
    STARTED   - Job was started
    FINISHED  - Job has been finished successfully
    FAILED       - Job had failed 

Step can be in one of the following statuses:
    VALIDATING  - Step is validating the requested operation
    EXECUTING  - Step is executing the requested operation
    FINALIZING   - Steps is finalysing the requested operation

== CRUD ==
Adding a flag named '''is_external''' to both '''Job''' and '''Step''' tables<br>
This flag indicates that the Job/Step was invoked as part of a plug-in operation and may be used in future to filter such jobs/steps

=== DAO ===
Adding '''isExternal''' flag to both '''JobDAODBFacadeImpl''' and '''StepDAODBFacadeImpl''' and wrap it with getter/setter

=== Metadata ===
Adding '''is_external''' to  '''Job''' and '''Step''' metadata in '''fixtures.xml'''

== Business Logic ==
Adding the following to '''VdcActionParametersBase'''
  jobId   - The Job UUID
  stepId  - The parent step UUID

This will be used by plug-ins in order to invoke internal oVirt commands and still let them appaer under the given Job/Step in the '''task Monitor'''<br>
In case that such a command is invoked not in the context of an external Job, its '''jobId''' and '''stepId''' will be null <br>

The ExecutionHandler::getJob is modified to test if the '''jobId''' and '''stepId''' are null and according to the result generate a new job or use the given one.<br>

=== New Supported Commands ===
 AddExternalJob - Adds an external Job and returns its UUID
 EndExternalJob - Ends the given Job
 AddExternalStep - Adds an external step to a Job directly or under an existing Step
                   If command is an oVirt internal command, it cpould be added only if it is flagged as '''Monitored'''
 EndExternalStep - Ends the given Step (For steps that represents plug-in operations only)

== Flow ==
''Add Job/Step'' Flow: <br>
 use api/jobs to add a new job using POST and giving a job '''description''' as a parameter
 use api/jobs/<jobId>/steps to add a new step using POST and giving a step '''parentId''' , '''parentType''', '''description''' and '''status''' as parameters (The parentId is the UUID of the parent of the new created step, the parentType may be '''Job''' or '''Step''')

''List Job(s)/Step(s): <br>
 use api/jobs to list all jobs
 use api/jobs/<jobId> to list the job identified by <jobId>
 use api/jobs/<jobId>/steps to list all steps of the job identified by <jobId>
 use api/jobs/<jobId>/<stepId> to list a specific step identified by <stepId> under the job identified by <jobId>

== Permissions ==

=== Command Permissions ===

=== Permissions on Entity Instances ===

== API ==
<!-- describe changes in REST API and SDK -->

== User Experience ==
<!-- Describe user experience related issues. For example: We need a wizard for ...., the behaviour is different in the UI because ....., etc. -->

== Installation/Upgrade ==
<!-- Describe how the feature will effect new installation or existing one. -->

=== User work-flows ===
<!-- Describe the high-level work-flows relevant to this feature. -->

== Enforcement ==


== Dependencies / Related Features and Projects ==
<!-- What other packages (RPMs) depend on this package?  Are there changes outside the developers' control on which completion of this feature depends?  -->
=== Affected oVirt projects ===

== Documentation / External references ==
<!-- Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs. -->


[[Features/ExternalTasks]]

== Future directions ==
<!-- Issues that we haven't decided how to take care of yet. These are issues that we need to resolve and change this document accordingly. -->


[[Category: Feature]]
