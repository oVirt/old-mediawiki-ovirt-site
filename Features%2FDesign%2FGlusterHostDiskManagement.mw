==Gluster Host Disk Management==

== Summary ==
This document describes the design of Disk Management feature for Gluster in Ovirt.  refer [[Features/GlusterHostDiskManagement]]

== Design ==

=== New Entities ===

==== StorageDevice ====
This entity helps to store the details of a storage device in the host. A host will nave multiple instance of this storage device to represent the storage devices in the host.
{| class="wikitable"
|+ StorageDevice
!Column name !! Type !! Description
|-
| id || UUID || Id  generated by engine (Primary Key)
|-
| devUuid || String || Dev UUID Given by the system to device
|-
| vds_id || UUID || Host ID  (Foreign Key to Host). 
|-
| name || String || Name of the device
|-
| model || String || Description about the device
|-
| devpath || String || Device Path
|-
| parent || String || Parent Device
|-
|mountPoint || String || Mount Point
|-
| fsType || String || File system type 
|-
| fsUuid || String || UUID for the file system in the device. 
|-
| isFree || boolean || Is device is already used or its free for usage.
|}

=== Sync Job ===
Information about the storage devices in the host will be fetched periodically and stored in the DB  by a sync job. This sync job will run for once in 24 hours. There will be an option in the UI to force sync the storage device details.

=== BLL commands ===
* <big>CreateBrick</big> - creates a logical volume with the given set of storage devices and format it with XFS file system and mounts the LV at a pre configured path. 
* <big>ExtendBrick</big> - Add the selected block devices to the given LV to increase the storage space available in the LV.
* <big>SyncStorageDevices</big> - Force sync the storage devices from host.

=== Engine Queries ===
* <big>GetStorageDevices</big> - lists all the Storage Devices available in the Host
* <big>HostGetUnusedBricksQuery</big> - lists all the Unused LVs in the Host.

=== VDSM Verbs ===
==== VDSM verbs for Disk Provisioning====
* <big>GlusterStorageDevicesList</big> -  Returns all the storage devices in the host
<TODO: explain verb's parameters and return structure>

* <big>GlusterBrickCreate</big> -  Create an LV which can be to create gluster volume
<TODO: explain verb's parameters and return structure>

* <big>GlusterBrickExpand</big> -  Expand the given LV by adding the selected disk
<TODO: explain verb's parameters and return structure>


=== REST APIs ===
The details of the REST APIs for Disk Provisioning feature are as below -

==== storagedevices sub-collection of the host resource ====
* A collection of storage devices that are attached to a specific host:
   /api/hosts/{host:id}/storagedevices
* Supported actions:
*# '''GET''' returns a list of storage devices attached to the host
Output:
 <storage_devices>
  <storage_device>
    <id>Storage device guid</id>
    <host>Host ID</host>
    <name>Device Name</name>
    <device_uuid>Device UUID</device_uuid>
    <file_system_uuid>Device UUID</file_system_uuid>
    <model>Device Model information</model>
    <device_path>device_path</device_path>
    <parent>Parent Device</parent>
    <mount_point>mount point if mounted</mount_point>
    <file_system_type>File System type</file_system_type>
    <is_free>Is Device is Free for use<is_free>
  </storage_device>
 </storage_devices>

==== storagedevice resource under host====
 /api/hosts/{host:id}/storagedevices/{storagedeviceuuid}
* Supported actions:
*# '''GET''' returns the details about the given storage device by uuid
Output:
<storage_device>
    <id>Storage device guid</id>
    <host>Host ID</host>
    <name>Device Name</name>
    <device_uuid>Device UUID</device_uuid>
    <file_system_uuid>Device UUID</file_system_uuid>
    <model>Device Model information</model>
    <device_path>device_path</device_path>
    <parent>Parent Device</parent>
    <mount_point>mount point if mounted</mount_point>
    <file_system_type>File System type</file_system_type>
    <is_free>Is Device is Free for use<is_free>
  </storage_device>

====Create Gluster Brick of the Host resource ====
*An action to create gluster brick
 /api/hosts/{host:id}/createbrick
* Supported actions:
** '''POST''' - executes CreateBrick action on the host

====Extend Gluster Brick of the Host resource ====
*An action to extand the given gluster  brick
 /api/hosts/{host:id}/storagedevices/{storagedeviceuuid}/extendbrick
* Supported actions:
** '''POST''' - executes ExtendBrick action on the given storage device

== Documentation / External references ==
<!-- Is there upstream documentation on this feature, or notes you have written yourself?  Link to that material here so other interested developers can get involved. Links to RFEs. -->
http://www.ovirt.org/Features/GlusterHostDiskManagement
