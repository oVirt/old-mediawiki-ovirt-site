<!-- {{autolang|base=yes}} -->

== Reporting vNIC implementation reported by Guest Agent Detailed Design ==

=== Summary ===
The Guest Agent reports the vNic details:
* IP addresses (both IPv4 and IPv6).
* vNic internal name 
[[http://wiki.ovirt.org/wiki/Feature/ReportingVnicImplementation Reporting vNIC implementation reported by Guest Agent Feature Page]]

=== Owner ===
* Name: Moti Asayag
* Email: masayag@redhat.com

=== Current status ===
* Target Release: 3.2
* Status: Design
* Last updated date: Nov 12 2012

=== Detailed Description ===
The internal vNic implementation details are reported by VDSM by verbs ''getVmStats'' and ''getAllVmStats''.
    netIfaces = [{'name': 'eth8', 'inet6': ['fe80::21a:4aff:fe16:1ac'], 'inet': ['10.35.17.36'], 'hw': '00:1a:4a:16:01:ac'}, 
                 {'name': 'eth9', 'inet6': ['fe80::21a:4aff:fe16:160','fe80::21a:4aff:fe16:161'], 'inet': ['10.35.1.254'], 'hw': '00:1a:4a:16:01:60'}, 
                 {'name': 'eth7', 'inet6': ['fe80::21a:4aff:fe16:1af'], 'inet': ['10.35.18.69'], 'hw': '00:1a:4a:16:01:af'}]

The vNic device data from the guest contains the interface name, the ipv4 addresses and the ipv6 addresses.

==== Engine ====

<span style="color:Teal">'''VM_INTERFACE_DYNAMIC'''</span> a new satellite table of vm_interface, contains the dynamic data reported by the guest<BR>
{|class="wikitable sortable"
!border="1"| Column Name ||Column Type ||Null? / Default ||Definition 
|-
|id ||UUID ||not null ||The vNic ID 
|-
|interface_name ||VARCHAR(50) ||null ||The vNic's name within the VM 
|-
|ipv4_addresses ||text ||null ||The vNic's IPv4 addresses 
|-
|ipv6_addresses ||text ||null ||The vNic's IPv6 addresses 
|-
|}

The IP addresses columns might multiple addresses per vNic and will be stored comma concatenated.<BR>
The table will be updated only when a change was detected by the reported data from VDSM.

<span style="color:Teal">'''VmNicDynamic'''</span> a new class for representing the data reported by the guest agent:
   Guid id - vNic ID
   String interface_name - the internal nic's name
   String ipv4Addresses - the vNic's IPv4 addresses
   String ipv6Addresses - the vNic's IPv6 addresses

<span style="color:Teal">'''VmNicDynamicDao'''</span> new DAO will serve as the interface of the VmNicDynamic entity database related actions.

<span style="color:Teal">'''VmNetworkInterface'''</span> is extended to contain VmNicDynamic.<BR>
: VmNicDynamic will not be stored to the database as part of saving/updating VmNetworkInterface in any of user flows, only as part of refresh VMs.

==== Engine Flows ====
<span style="color:Teal">'''Update Vm Network Interface'''</span> - requires initializing the content of the vNic's dynamic data.<BR>

<span style="color:Teal">'''VdsUpdateRunTimeInfo.refreshVms'''</span> - will refresh the vnic's dynamic data (as an optimization only if the data was changed). Update should be performed as a mass-operation.

==== VDSM API ====
No changes for VDSM API.

==== Upgrade DB ====
# Add the new table '''VM_INTERFACE_DYNAMIC''' and related stored-procedure for add/update/delete.

=== Dependencies / Related Features and Projects ===

=== Open Issues ===
NA

[[Category:Template]]
[[Category:Feature]]
